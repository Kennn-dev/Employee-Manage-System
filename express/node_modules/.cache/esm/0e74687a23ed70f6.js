let Employee,Admin,getTokens,SECRETKEY,verify;_23e‍.x([["default",()=>_23e‍.o]]);_23e‍.w("../models/Employee",[["default",["Employee"],function(v){Employee=v}]]);_23e‍.w("../models/Admin",[["default",["Admin"],function(v){Admin=v}]]);_23e‍.w("../functions/index",[["getTokens",["getTokens"],function(v){getTokens=v}]]);_23e‍.w("../config/index",[["SECRETKEY",["SECRETKEY"],function(v){SECRETKEY=v}]]);_23e‍.w("jsonwebtoken",[["verify",["verify"],function(v){verify=v}]]);





const authMiddleWare = async (req, res, next) => {
  // Extract Authorization Header

  const token = req.headers.authorization;
  if (!token) {
    req.isAuth = false;
    return next();
  }
  try {
    const tokenValue = token.split(" ")[1]; //ok
    // console.log(tokenValue);
    const { id } = verify(tokenValue, SECRETKEY);
    // console.log(id);
    const user = await Employee.findById(id);
    if (!user) {
      const admin = await Admin.findById(id);
      if (!admin) {
        req.isAuth = false;
        return next();
      }
      console.log("admin");
      req.isAuth = true;
      req.admin = admin.id;
      return next();
    }

    req.user = user.id;
    req.isAuth = true;
    return next();
  } catch (error) {
    req.isAuth = false;
    return next();
  }

  // no cookies
};
_23e‍.d(authMiddleWare);
